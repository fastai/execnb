# shell


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
from fastcore.test import *
from base64 import b64decode
from io import BytesIO
from PIL import Image
```

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L50"
target="_blank" style="float:right; font-size:smaller">source</a>

### ExecutionResult.\_\_repr\_\_

>  ExecutionResult.__repr__ ()

*Return repr(self).*

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L47"
target="_blank" style="float:right; font-size:smaller">source</a>

### ExecutionInfo.\_\_repr\_\_

>  ExecutionInfo.__repr__ ()

*Return repr(self).*

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L53"
target="_blank" style="float:right; font-size:smaller">source</a>

### CaptureShell

>  CaptureShell (path:str|pathlib.Path=None, mpl_format='retina',
>                    history=False, timeout=None)

*An enhanced, interactive shell for Python.*

``` python
s = CaptureShell(mpl_format='retina')
```

``` python
s.run_cell('a=1');
```

``` python
o = s.run_cell('print(a)')
o
```

``` json
{ 'display_objects': [],
  'exception': None,
  'quiet': False,
  'result': result: None; err: None; info: <cell: print(a); id: None>,
  'stderr': '',
  'stdout': '1\n'}
```

``` python
o = s.run_cell('from warnings import warn; warn("1")')
o
```

``` json
{ 'display_objects': [],
  'exception': None,
  'quiet': False,
  'result': result: None; err: None; info: <cell: from warnings import warn; warn("1"); id: None>,
  'stderr': '<ipython-input-1-a51443ae013a>:1: UserWarning: 1\n'
            '  from warnings import warn; warn("1")\n',
  'stdout': ''}
```

``` python
o = s.run_cell('1')
o
```

``` json
{ 'display_objects': [],
  'exception': None,
  'quiet': False,
  'result': result: 1; err: None; info: <cell: 1; id: None>,
  'stderr': '',
  'stdout': ''}
```

``` python
o = s.run_cell('from IPython.display import Markdown,display; print(0); display(Markdown("*2*")); Markdown("*1*")')
o
```

``` json
{ 'display_objects': [<IPython.utils.capture.RichOutput object>],
  'exception': None,
  'quiet': False,
  'result': result: <IPython.core.display.Markdown object>; err: None; info: <cell: from IPython.display import Markdown,display; print(0); display(Markdown("*2*")); Markdown("*1*"); id: None>,
  'stderr': '',
  'stdout': '0\n'}
```

``` python
o.result.result
```

*1*

``` python
o.display_objects[0]
```

*2*

``` python
o = s.run_cell('1;')
o
```

``` json
{ 'display_objects': [],
  'exception': None,
  'quiet': True,
  'result': result: 1; err: None; info: <cell: 1;; id: None>,
  'stderr': '',
  'stdout': ''}
```

``` python
o = s.run_cell('import matplotlib.pyplot as plt; plt.plot([1,2,3])')
o
```

``` json
{ 'display_objects': [<IPython.utils.capture.RichOutput object>],
  'exception': None,
  'quiet': False,
  'result': result: [<matplotlib.lines.Line2D object>]; err: None; info: <cell: import matplotlib.pyplot as plt; plt.plot([1,2,3]); id: None>,
  'stderr': '',
  'stdout': ''}
```

``` python
o.result.result[0]
```

``` python
o.display_objects[0]
```

<img src="02_shell_files/figure-commonmark/cell-17-output-1.png"
width="556" height="413" />

``` python
o = s.run_cell('''
import pandas as pd
pd.DataFrame({'A': [1, 2], 'B': [3, 4]})''')
o
```

``` json
{ 'display_objects': [],
  'exception': None,
  'quiet': False,
  'result': result:    A  B
0  1  3
1  2  4; err: None; info: <cell: 
import pandas as pd
pd.DataFrame({'A': [1, 2], 'B': [3, 4]}); id: None>,
  'stderr': '',
  'stdout': ''}
```

``` python
o.result.result
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>4</td>
</tr>
</tbody>
</table>

</div>

``` python
o = s.run_cell('1/0')
o
```

``` json
{ 'display_objects': [],
  'exception': ZeroDivisionError('division by zero'),
  'quiet': False,
  'result': result: None; err: division by zero; info: <cell: 1/0; id: None>,
  'stderr': '',
  'stdout': '\x1b[0;31m---------------------------------------------------------------------------\x1b[0m\n'
            '\x1b[0;31mZeroDivisionError\x1b[0m                         '
            'Traceback (most recent call last)\n'
            'File \x1b[0;32m<ipython-input-1-9e1622b385b6>:1\x1b[0m\n'
            '\x1b[0;32m----> 1\x1b[0m '
            '\x1b[38;5;241m1\x1b[39m\x1b[38;5;241m/\x1b[39m\x1b[38;5;241m0\x1b[39m\n'
            '\n'
            '\x1b[0;31mZeroDivisionError\x1b[0m: division by zero\n'}
```

``` python
o = s.run_cell('import time; time.sleep(2)', timeout=1)
o['exception']
```

    TimeoutError()

### Cells

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L93"
target="_blank" style="float:right; font-size:smaller">source</a>

### format_exc

>  format_exc (e)

*Format exception `e` as a string*

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L129"
target="_blank" style="float:right; font-size:smaller">source</a>

### CaptureShell.run

>  CaptureShell.run (code:str, stdout=True, stderr=True)

*Run `code`, returning a list of all outputs in Jupyter notebook format*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>str</td>
<td></td>
<td>Python/IPython code to run</td>
</tr>
<tr>
<td>stdout</td>
<td>bool</td>
<td>True</td>
<td>Capture stdout and save as output?</td>
</tr>
<tr>
<td>stderr</td>
<td>bool</td>
<td>True</td>
<td>Capture stderr and save as output?</td>
</tr>
</tbody>
</table>

``` python
s = CaptureShell()
```

``` python
s.run("print(1)")
```

    [{'name': 'stdout', 'output_type': 'stream', 'text': ['1\n']}]

Code can include magics and `!` shell commands:

``` python
o = s.run("%time 1+1")
o
```

    [{'name': 'stdout',
      'output_type': 'stream',
      'text': ['CPU times: user 3 us, sys: 1e+03 ns, total: 4 us\n',
       'Wall time: 5.96 us\n']},
     {'data': {'text/plain': ['2']},
      'metadata': {},
      'output_type': 'execute_result'}]

``` python
o = s.run("1/0")
o
```

    [{'name': 'stdout',
      'output_type': 'stream',
      'text': ['\x1b[0;31m---------------------------------------------------------------------------\x1b[0m\n',
       '\x1b[0;31mZeroDivisionError\x1b[0m                         Traceback (most recent call last)\n',
       'File \x1b[0;32m<ipython-input-1-9e1622b385b6>:1\x1b[0m\n',
       '\x1b[0;32m----> 1\x1b[0m \x1b[38;5;241m1\x1b[39m\x1b[38;5;241m/\x1b[39m\x1b[38;5;241m0\x1b[39m\n',
       '\n',
       '\x1b[0;31mZeroDivisionError\x1b[0m: division by zero\n']},
     {'ename': 'ZeroDivisionError',
      'evalue': 'division by zero',
      'output_type': 'error',
      'traceback': 'Traceback (most recent call last):\n  File "/home/jhoward/miniconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py", line 3577, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File "<ipython-input-1-9e1622b385b6>", line 1, in <module>\n    1/0\n    ~^~\nZeroDivisionError: division by zero\n'}]

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L140"
target="_blank" style="float:right; font-size:smaller">source</a>

### render_outputs

>  render_outputs (outputs, ansi_renderer=<function strip_ansi>)

``` python
HTML(render_outputs(o))
```

<pre>---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)
File <ipython-input-1-9e1622b385b6>:1
----> 1 1/0
&#10;ZeroDivisionError: division by zero
</pre>

We can use `ansi2html` to convert from ANSI to HTML for color rendering.
You need some [css
styles](https://github.com/fastai/fastcore/blob/master/examples/ansi.css)
for the colors to render properly. Jupyter already has these built in so
itâ€™s not neccessary here, but if you plan on using this in another web
app you will need to ensure that css styling is included.

``` python
HTML(render_outputs(o, ansi2html))
```

<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ZeroDivisionError</span>                         Traceback (most recent call last)
File <span class="ansi-green-fg">&lt;ipython-input-1-9e1622b385b6&gt;:1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span style="color: rgb(98,98,98)">1</span><span style="color: rgb(98,98,98)">/</span><span style="color: rgb(98,98,98)">0</span>
&#10;<span class="ansi-red-fg">ZeroDivisionError</span>: division by zero
</pre>

The result of the last successful execution is stored in `result`:

``` python
s.result
```

A trailing `;` stops the result from being captured:

``` python
s.run("1+2;")
```

    []

Images and matplotlib figures are captured:

``` python
res = s.run('''import matplotlib.pyplot as plt
plt.figure(figsize=(2,1))
plt.plot([1,2,4]);''')

HTML(render_outputs(res))
```

<img src="data:image/png;base64,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du1aAEBYWBjeffddSeZw+hjI5XLDbY1Gc9P7//Akj5eXl8VmIiLnUFRUhIULF0Kr1UIul2Pnzp0ICwuTZBanj4Gfn5/htimXfrq7uwGYdkmJiOh6qqurkZ6ejtbWVri6umLHjh2YPn26ZPM4fQzkcjmCg4MBALW1tTe8b2trqyEG0dHRFp+NiBxTXV0dZs2ahbq6OshkMnz44YdYsGCBpDM5fQwAIDExEQBQUVEBrVZ73fuVlpYabkvxpV9EZP+am5sxe/ZsVFVVAQDeeecdwze0SokxADB16lQAg5eAvv/+++veb/jXAaemplp8LiJyLO3t7ZgzZw6Ki4sBAJs2bcKKFSsknmoQYwDgkUceMdz+6KOPRO+j1+vxySefAAACAgKu+dZxIqKb6enpQUZGBs6cOQMAWLduHdasWSPxVD9iDACkpKRg2rRpAIC//OUvOHXqlNF9tm7daviu45UrV8Ld3d2qMxKR/dJoNFi4cKHhZWxWrlyJjRs3SjzVtfjDbYacPXsWqamp6O3tha+vL1588UWkpaWht7cXO3bswJ///GcAgz/g5vTp09d8FRI5n+PHj6OiosLw6+bmZqxatQrA4CXEJ5988pr786efObdFixZh165dAICZM2fid7/73Q1/QJKHhwfi4uKsNR4AxuAa/ElnZKrHH38cH3/8scn35z8z53ajT/xiRo0ahYsXL1pmmOvgZaJh5s+fj4KCAjz33HOIi4uDt7c3AgICcO+992Lz5s04e/YsQ0BEDombARERcTMgIiLGgIiIwBgQEREYAyIiAmNARERgDIiICIwBERGBMSAiIjAGREQExoCIiMAYEBERGAMiIgJjQEREYAyIiAiMARERgTEgIiIwBkREBMaAiIjAGBARERgDIiICY0BERGAMiIgIjAEREYExICIiMAZERATg/wF8H3u+cAqVAAAAAABJRU5ErkJggg=="/>

If an exception is raised then the exception type, object, and
stacktrace are stored in `exc`:

``` python
o = s.run('raise Exception("Oops")')
o
```

    [{'name': 'stdout',
      'output_type': 'stream',
      'text': ['\x1b[0;31m---------------------------------------------------------------------------\x1b[0m\n',
       '\x1b[0;31mException\x1b[0m                                 Traceback (most recent call last)\n',
       'File \x1b[0;32m<ipython-input-1-01648acb07bd>:1\x1b[0m\n',
       '\x1b[0;32m----> 1\x1b[0m \x1b[38;5;28;01mraise\x1b[39;00m \x1b[38;5;167;01mException\x1b[39;00m(\x1b[38;5;124m"\x1b[39m\x1b[38;5;124mOops\x1b[39m\x1b[38;5;124m"\x1b[39m)\n',
       '\n',
       '\x1b[0;31mException\x1b[0m: Oops\n']},
     {'ename': 'Exception',
      'evalue': 'Oops',
      'output_type': 'error',
      'traceback': 'Traceback (most recent call last):\n  File "/home/jhoward/miniconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py", line 3577, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File "<ipython-input-1-01648acb07bd>", line 1, in <module>\n    raise Exception("Oops")\nException: Oops\n'}]

``` python
s.exc
```

    Exception('Oops')

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L165"
target="_blank" style="float:right; font-size:smaller">source</a>

### CaptureShell.cell

>  CaptureShell.cell (cell, stdout=True, stderr=True)

*Run `cell`, skipping if not code, and store outputs back in cell*

``` python
clean = Path('../tests/clean.ipynb')
nb = read_nb(clean)
c = nb.cells[1]
c
```

``` json
{ 'cell_type': 'code',
  'execution_count': None,
  'id': 'b123d6d0',
  'idx_': 1,
  'metadata': {},
  'outputs': [],
  'source': 'print(1)\n2'}
```

``` python
s.cell(c)
c.outputs
```

    [{'name': 'stdout', 'output_type': 'stream', 'text': ['1\n']},
     {'data': {'text/plain': ['2']},
      'metadata': {},
      'output_type': 'execute_result'}]

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L176"
target="_blank" style="float:right; font-size:smaller">source</a>

### find_output

>  find_output (outp, ot='execute_result')

*Find first output of type `ot` in
[`CaptureShell.run`](https://fastai.github.io/execnb/shell.html#captureshell.run)
output*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>outp</td>
<td></td>
<td></td>
<td>Output from <code>run</code></td>
</tr>
<tr>
<td>ot</td>
<td>str</td>
<td>execute_result</td>
<td>Output_type to find</td>
</tr>
</tbody>
</table>

``` python
find_output(c.outputs)['data']
```

``` json
{'text/plain': ['2']}
```

``` python
find_output(c.outputs, 'stream')['text']
```

    ['1\n']

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L183"
target="_blank" style="float:right; font-size:smaller">source</a>

### out_exec

>  out_exec (outp)

*Get data from execution result in `outp`.*

``` python
out_exec(c.outputs)
```

    '2'

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L189"
target="_blank" style="float:right; font-size:smaller">source</a>

### out_stream

>  out_stream (outp)

*Get text from stream in `outp`.*

``` python
out_stream(c.outputs)
```

    '1'

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L195"
target="_blank" style="float:right; font-size:smaller">source</a>

### out_error

>  out_error (outp)

*Get traceback from error in `outp`.*

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L204"
target="_blank" style="float:right; font-size:smaller">source</a>

### CaptureShell.run_all

>  CaptureShell.run_all (nb, exc_stop:bool=False, preproc:<built-
>                            infunctioncallable>=<function _false>,
>                            postproc:<built-infunctioncallable>=<function
>                            _false>, inject_code:str|None=None,
>                            inject_idx:int=0)

*Run all cells in `nb`, stopping at first exception if `exc_stop`*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>nb</td>
<td></td>
<td></td>
<td>A notebook read with <code>nbclient</code> or <a
href="https://fastai.github.io/execnb/nbio.html#read_nb"><code>read_nb</code></a></td>
</tr>
<tr>
<td>exc_stop</td>
<td>bool</td>
<td>False</td>
<td>Stop on exceptions?</td>
</tr>
<tr>
<td>preproc</td>
<td>callable</td>
<td>_false</td>
<td>Called before each cell is executed</td>
</tr>
<tr>
<td>postproc</td>
<td>callable</td>
<td>_false</td>
<td>Called after each cell is executed</td>
</tr>
<tr>
<td>inject_code</td>
<td>str | None</td>
<td>None</td>
<td>Code to inject into a cell</td>
</tr>
<tr>
<td>inject_idx</td>
<td>int</td>
<td>0</td>
<td>Cell to replace with <code>inject_code</code></td>
</tr>
</tbody>
</table>

``` python
nb.cells[2].outputs
```

    []

``` python
s.run_all(nb)
nb.cells[2].outputs
```

    [{'data': {'text/plain': ['<IPython.core.display.Markdown object>'],
       'text/markdown': ["This is *bold*. Here's a [link](https://www.fast.ai)."]},
      'metadata': {},
      'output_type': 'execute_result'}]

With `exc_stop=False` (the default), execution continues after
exceptions, and exception details are stored into the appropriate cellâ€™s
output:

``` python
nb.cells[-1].source
```

    'raise Exception("Oopsie!")'

``` python
nb.cells[-1].outputs
```

    [{'name': 'stdout',
      'output_type': 'stream',
      'text': ['\x1b[0;31m---------------------------------------------------------------------------\x1b[0m\n',
       '\x1b[0;31mException\x1b[0m                                 Traceback (most recent call last)\n',
       'File \x1b[0;32m<ipython-input-1-1c97c1d317ab>:1\x1b[0m\n',
       '\x1b[0;32m----> 1\x1b[0m \x1b[38;5;28;01mraise\x1b[39;00m \x1b[38;5;167;01mException\x1b[39;00m(\x1b[38;5;124m"\x1b[39m\x1b[38;5;124mOopsie!\x1b[39m\x1b[38;5;124m"\x1b[39m)\n',
       '\n',
       '\x1b[0;31mException\x1b[0m: Oopsie!\n']},
     {'ename': 'Exception',
      'evalue': 'Oopsie!',
      'output_type': 'error',
      'traceback': 'Traceback (most recent call last):\n  File "/home/jhoward/miniconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py", line 3577, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File "<ipython-input-1-1c97c1d317ab>", line 1, in <module>\n    raise Exception("Oopsie!")\nException: Oopsie!\n'}]

With `exc_stop=True`, exceptions in a cell are raised and no further
processing occurs:

``` python
try: s.run_all(nb, exc_stop=True)
except Exception as e: print(f"got exception: {e}")
```

    got exception: Oopsie!

We can pass a function to `preproc` to have it run on every cell. It can
modify the cell as needed. If the function returns `True`, then that
cell will not be executed. For instance, to skip the cell which raises
an exception:

``` python
nb = read_nb(clean)
s.run_all(nb, preproc=lambda c: 'raise' in c.source)
```

This cell will contain no output, since it was skipped.

``` python
nb.cells[-1].outputs
```

    []

``` python
nb.cells[1].outputs
```

    [{'name': 'stdout', 'output_type': 'stream', 'text': ['1\n']},
     {'data': {'text/plain': ['2']},
      'metadata': {},
      'output_type': 'execute_result'}]

You can also pass a function to `postproc` to modify a cell after it is
executed.

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L222"
target="_blank" style="float:right; font-size:smaller">source</a>

### CaptureShell.execute

>  CaptureShell.execute (src:str|pathlib.Path, dest:str|None=None,
>                            exc_stop:bool=False, preproc:<built-
>                            infunctioncallable>=<function _false>,
>                            postproc:<built-infunctioncallable>=<function
>                            _false>, inject_code:str|None=None,
>                            inject_path:str|pathlib.Path|None=None,
>                            inject_idx:int=0)

*Execute notebook from `src` and save with outputs to \`dest*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>src</td>
<td>str | pathlib.Path</td>
<td></td>
<td>Notebook path to read from</td>
</tr>
<tr>
<td>dest</td>
<td>str | None</td>
<td>None</td>
<td>Notebook path to write to</td>
</tr>
<tr>
<td>exc_stop</td>
<td>bool</td>
<td>False</td>
<td>Stop on exceptions?</td>
</tr>
<tr>
<td>preproc</td>
<td>callable</td>
<td>_false</td>
<td>Called before each cell is executed</td>
</tr>
<tr>
<td>postproc</td>
<td>callable</td>
<td>_false</td>
<td>Called after each cell is executed</td>
</tr>
<tr>
<td>inject_code</td>
<td>str | None</td>
<td>None</td>
<td>Code to inject into a cell</td>
</tr>
<tr>
<td>inject_path</td>
<td>str | pathlib.Path | None</td>
<td>None</td>
<td>Path to file containing code to inject into a cell</td>
</tr>
<tr>
<td>inject_idx</td>
<td>int</td>
<td>0</td>
<td>Cell to replace with <code>inject_code</code></td>
</tr>
</tbody>
</table>

This is a shortcut for the combination of
[`read_nb`](https://fastai.github.io/execnb/nbio.html#read_nb),
[`CaptureShell.run_all`](https://fastai.github.io/execnb/shell.html#captureshell.run_all),
and [`write_nb`](https://fastai.github.io/execnb/nbio.html#write_nb).

``` python
s = CaptureShell()
try:
    s.execute(clean, 'tmp.ipynb')
    print(read_nb('tmp.ipynb').cells[1].outputs)
finally: Path('tmp.ipynb').unlink()
```

    [{'name': 'stdout', 'output_type': 'stream', 'text': ['1\n']}, {'data': {'text/plain': ['2']}, 'metadata': {}, 'output_type': 'execute_result'}]

``` python
p = Path.home()/'git'/'fastcore'/'nbs'
n = p/'03a_parallel.ipynb'
```

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L243"
target="_blank" style="float:right; font-size:smaller">source</a>

### CaptureShell.prettytb

>  CaptureShell.prettytb (fname:str|pathlib.Path=None)

*Show a pretty traceback for notebooks, optionally printing `fname`.*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>fname</td>
<td>str | pathlib.Path</td>
<td>None</td>
<td>filename to print alongside the traceback</td>
</tr>
</tbody>
</table>

If an error occurs while running a notebook, you can retrieve a pretty
version of the error with the `prettytb` method:

``` python
s = CaptureShell()
try:
    s.execute('../tests/error.ipynb', exc_stop=True)
except:
    print(s.prettytb())
```

    AssertionError in ../tests/error.ipynb:
    ===========================================================================

    While Executing Cell #2:
    Traceback (most recent call last):
      File "/tmp/ipykernel_17198/1421292703.py", line 3, in <module>
        s.execute('../tests/error.ipynb', exc_stop=True)
      File "/tmp/ipykernel_17198/3609882568.py", line 18, in execute
        self.run_all(nb, exc_stop=exc_stop, preproc=preproc, postproc=postproc,
      File "/tmp/ipykernel_17198/3068237356.py", line 19, in run_all
        if self.exc and exc_stop: raise self.exc from None
                                  ^^^^^^^^^^^^^^^^^^^^^^^^
      File "/home/jhoward/miniconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py", line 3577, in run_code
        exec(code_obj, self.user_global_ns, self.user_ns)
      File "<ipython-input-1-b968a57a586e>", line 3, in <module>
        foo()
      File "/home/jhoward/git/execnb/tests/err.py", line 2, in foo
        assert 13 == 98
               ^^^^^^^^
    AssertionError

If you pass `inject_code` to
[`CaptureShell.execute`](https://fastai.github.io/execnb/shell.html#captureshell.execute)
or
[`CaptureShell.run_all`](https://fastai.github.io/execnb/shell.html#captureshell.run_all),
the source of `nb.cells[inject_idx]` will be replaced with
`inject_code`. By default, the first cell is replaced. For instance
consider this notebook:

``` python
nb = read_nb('../tests/params.ipynb')
for c in nb.cells: print('- ',c.source)
```

    -  a=1
    -  print(a)

We can replace the first cell with `a=2` by passing that as
`inject_code`, and the notebook will run with that change:

``` python
nb = read_nb('../tests/params.ipynb')
s.run_all(nb, inject_code="a=2")
list(nb.cells)
```

    [{'cell_type': 'code',
      'execution_count': None,
      'id': 'a63ce885',
      'metadata': {},
      'outputs': [],
      'source': 'a=2',
      'idx_': 0},
     {'cell_type': 'code',
      'execution_count': None,
      'id': 'ea528db5',
      'metadata': {},
      'outputs': [{'name': 'stdout', 'output_type': 'stream', 'text': ['2\n']}],
      'source': 'print(a)',
      'idx_': 1}]

This can be used with
[`CaptureShell.execute`](https://fastai.github.io/execnb/shell.html#captureshell.execute)
to parameterise runs of models in notebooks. Place any defaults for
configuration code needed in the first cell, and then when running
`execute` pass in new parameters as needed in `inject_code`. To replace
only some of the defaults, leave an empty cell as the second cell, and
inject code using `inject_idx=1` to replace the empty second cell with
code that overrides some of the defaults set in the first cell. When
using `execute` you can pass `inject_path` instead of `inject_code` to
read the injected code from a file.

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L255"
target="_blank" style="float:right; font-size:smaller">source</a>

### exec_nb

>  exec_nb (src:str, dest:str='', exc_stop:bool=False, inject_code:str=None,
>               inject_path:str=None, inject_idx:int=0)

*Execute notebook from `src` and save with outputs to `dest`*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>src</td>
<td>str</td>
<td></td>
<td>Notebook path to read from</td>
</tr>
<tr>
<td>dest</td>
<td>str</td>
<td></td>
<td>Notebook path to write to</td>
</tr>
<tr>
<td>exc_stop</td>
<td>bool</td>
<td>False</td>
<td>Stop on exceptions?</td>
</tr>
<tr>
<td>inject_code</td>
<td>str</td>
<td>None</td>
<td>Code to inject into a cell</td>
</tr>
<tr>
<td>inject_path</td>
<td>str</td>
<td>None</td>
<td>Path to file containing code to inject into a cell</td>
</tr>
<tr>
<td>inject_idx</td>
<td>int</td>
<td>0</td>
<td>Cell to replace with <code>inject_code</code></td>
</tr>
</tbody>
</table>

This is the command-line version of
[`CaptureShell.execute`](https://fastai.github.io/execnb/shell.html#captureshell.execute).
Run `exec_nb -h` from the command line to see how to pass arguments. If
you donâ€™t pass `dest` then the output notebook wonâ€™t be saved; this is
mainly useful for running tests.

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L268"
target="_blank" style="float:right; font-size:smaller">source</a>

### SmartCompleter

>  SmartCompleter (shell, namespace=None, jedi=False)

*Extension of the completer class with IPython-specific features*

``` python
cc = SmartCompleter(get_ipython())

def test_set(a,b): return test_eq(set(a), set(b))

class _f:
    def __init__(self): self.bar,self.baz,self.room = 0,0,0

foo = _f()

assert set(cc("b")).issuperset(['bool', 'bytes'])
test_set(cc("foo.b"), ['bar', 'baz'])
test_set(cc("x=1; x = foo.b"), ['bar', 'baz'])
test_set(cc("ab"), ['abs'])
test_set(cc("b = ab"), ['abs'])
test_set(cc(""), [])
test_set(cc("foo."), ['bar', 'baz', 'room'])
test_set(cc("nonexistent.b"), [])
test_set(cc("foo.nonexistent.b"), [])
assert set(cc("import ab")).issuperset(['abc'])
test_set(cc("from abc import AB"), ['ABC', 'ABCMeta'])
```

------------------------------------------------------------------------

<a
href="https://github.com/fastai/execnb/blob/master/execnb/shell.py#L289"
target="_blank" style="float:right; font-size:smaller">source</a>

### CaptureShell.complete

>  CaptureShell.complete (c)

*Return the completed text and a list of completions.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>string</strong></td>
<td><strong>The actual text that was completed.</strong></td>
</tr>
</tbody>
</table>

``` python
s = CaptureShell()
s.run('a=1')
s.complete('a.b')
```

    ['bit_count', 'bit_length']
